<!DOCTYPE html>
<html lang="en">

<head>
    <script>
        const params = new URLSearchParams(window.location.search);
        const allowedLaunch = params.has("launch") || params.has("start");
        const isTop = window.self === window.top;
        if (isTop && !allowedLaunch && window.location.pathname !== "/start.html") {
            window.location.replace("/start.html");
        }
    </script>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width">
    <link rel="preconnect" href="https://cdn.jsdelivr.net">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link rel="preconnect" href="https://mexicoon.top">
    <link rel="icon" href="images/ixl-favicon.png">
    <title>IXL | Maths, English and Science Practice</title>
    <script src="https://cdn.jsdelivr.net/npm/@tailwindcss/browser@4"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <script src="/uv/uv.bundle.js"></script>
    <script src="/uv/uv.config.js"></script>
    <script src="/baremux/index.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@tailwindcss/browser@4"></script>
    <script src="/assets/js/t.js" defer></script>
    <script src="https://cdn.jsdelivr.net/npm/@widgetbot/html-embed"></script>
    <script src="/homework/math.all.js"></script>
    <link rel="stylesheet" href="/styles/index.css">
    <link rel="stylesheet" href="/assets/css/colors.css" id="css-theme-link">
    <link rel="stylesheet" href="/fa/css/all.css">
    <link rel="stylesheet" href="/fa/css/all.min.css">
    <link rel="stylesheet" href="/fa/css/solid.css">
    <link rel="stylesheet" href="/fa/css/all-pro.css">
    <link rel="stylesheet" href="/assets/css/t.css">
    <link rel="stylesheet" href="/assets/css/dropdown.css">
    <link rel="stylesheet" href="/assets/css/favorites.css">
    <link rel="stylesheet" href="/assets/css/playtime.css">
    <link rel="stylesheet" href="/assets/css/backend.css">
    <link rel="stylesheet" href="/assets/css/carousel.css">
    <link rel="stylesheet" href="/assets/css/walkthrough.css">
    <script src="/assets/js/cursor.js" defer></script>
    <script src="/assets/js/colors.js"></script>
    <script src="/assets/js/splash.js" defer></script>
    <script src="/assets/js/favorites.js"></script>
    <script src="/assets/js/playtime.js"></script>
    <script src="/assets/js/browserfunctions.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script src="/assets/js/backend/supabase-client.js"></script>
    <script src="/assets/js/lib/three.min.js"></script>
    <script src="/assets/js/lib/vanta.fog.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/eruda@3.4.3/eruda.min.js"></script>

    <script src="/assets/js/backend/reviews.js"></script>
    <script src="/assets/js/backend/leaderboard.js"></script>
    <script src="/assets/js/carousel.js"></script>
    <script src="/assets/js/lib/particles.js"></script>
    <meta name="title" content="IXL | Maths, English and Science Practice">
    <meta name="description"
        content="IXL is the world's most popular subscription-based learning site. Used by over 17 million students, IXL provides unlimited practice in more than 6400 maths, English and science skills.">
    <meta name="keywords" content="IXL, maths, english, science, practice, learning, education, skills, students">
    <meta name="robots" content="index, nofollow">
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
    <meta property="og:image" content="/assets/img/cover.png">
    <meta property="twitter:image" content="/assets/img/cover.png">
    <meta name="language" content="English">
    <meta name="revisit-after" content="2 days">
    <meta name="author" content="x8r and verdis team">

    <link rel="stylesheet" href="/assets/css/font.css">
    <link rel="stylesheet" href="/assets/icons/fonts/remixicon.css">

</html>
</head>

<body>
    <nav id="main-nav">
        <ul>
            <li id="nav-home-morph">
                <a onclick="window.location.reload()" href="#">
                    <i class="ri-home-4-line"></i>
                </a>
            </li>
            <li>
                <a id="playtime-btn" href="#" aria-label="Playtime">
                    <i class="fas fa-mountain" onclick="event.stopPropagation(); openAB()" aria-label="Cave cloak"></i>
                    <span class="playtime-divider-icon">|</span>
                    <i class="far fa-clock" onclick="VerdisPlaytime.toggleModal()"></i>
                    <span class="playtime-text" onclick="VerdisPlaytime.toggleModal()">0m</span>
                </a>
            </li>
            <li class="divider"></li>
            <li>
                <a onclick="toggleGames()" href="#" data-page="games">
                    <i class="ri-gamepad-line"></i>
                </a>
            </li>
            <li>
                <a onclick="toggleApps()" href="#" data-page="apps">
                    <i class="ri-apps-line"></i>
                </a>
            </li>
            <li>
                <a onclick="navTo('movies')" href="#" data-page="movies">
                    <i class="ri-video-line"></i>
                </a>
            </li>
            <li>
                <a onclick="navTo('vms'); showToast('success', 'VMs are still in beta! Report bugs on the repo/Discord.', 'fas fa-exclamation-triangle')"
                    href="#" data-page="vms">
                    <i class="ri-computer-line"></i>
                </a>
            </li>
            <li>
                <a onclick="navTo('android')" href="#" data-page="android">
                    <i class="ri-smartphone-line"></i>
                </a>
            </li>
            <li>
                <a onclick="navTo('assistant'); showToast('success', 'AI is in beta! Report bugs on the Discord/Repo', 'fas fa-exclamation-triangle')"
                    href="#" data-page="ai">
                    <i class="ri-robot-2-line"></i>
                </a>
            </li>
            <!--
            <li>
                <a onclick="toggleChat()" href="#" data-page="social">
                    <i class="fas fa-messages"></i>
                </a>
            </li>
            -->
            <li>
                <a onclick="toggleSettings()" href="#" data-page="dc">
                    <i class="ri-settings-3-line"></i>
                </a>
            </li>
            <li class="divider"></li>
            <li id="nav-user-count" class="online-users-nav">
                <a href="#" aria-label="Online Users">
                    <i class="fas fa-users"></i>
                    <span class="navbar-divider-icon">|</span>
                    <span id="user-count" class="user-count-text">0</span>
                </a>
            </li>
        </ul>
    </nav>
    <div id="homeContent">
        <h1 class="text-7xl font-medium home-gradient">
            verdis</h1>
        <p id="splash" class="text-medium font-light text-white/50">
            wsp
        </p>
        <br>
        <div class="searchathome">
            <i class="fas fa-search"></i>
            <input id="homesearch" disabled autocomplete="off" style="margin-right: -3%;" type="text"
                placeholder="search not ready yet!" />
            <svg viewBox="25 25 50 50" class="loading">
                <circle r="20" cy="50" cx="50"></circle>
            </svg>
        </div>
        <div class="search-warning" style="margin: 6px 0 0 6px;">This is a proxy; you could get in trouble.</div>
        <br>
    </div>

    <!-- Top Games Carousel (fixed at bottom, behind quick access) -->
    <div class="top-games-carousel" id="topGamesCarousel">
        <div class="top-games-title"><i class="fas fa-fire"></i> Top Games This Week</div>
        <div class="top-games-track" id="topGamesTrack">
            <!-- Populated by JS -->
        </div>
    </div>

    <!-- Quick Access Favorites Section (separate from homeContent to not push layout) -->
    <div class="quick-access-section" id="quickAccessSection" style="display: none;">
        <h3><i class="fas fa-star"></i> Quick Access</h3>
        <div class="quick-access-container" id="quickAccessContainer">
        </div>
    </div>

    <!-- Playtime Tracker Modal -->
    <div class="playtime-modal settings-hidden">
        <div class="playtime-modal-header">
            <h3><i class="far fa-clock"></i> Your Playtime</h3>
            <button class="playtime-close-btn" onclick="VerdisPlaytime.toggleModal()">
                <i class="fas fa-times"></i>
            </button>
        </div>
        <div id="playtime-breakdown">
            <!-- Content rendered by JS -->
        </div>
    </div>

    <!-- Game Details Modal -->
    <div class="game-details-modal settings-hidden" id="gameDetailsModal">
        <div class="modal-content">
            <button class="modal-close-btn" onclick="closeGameDetails()">
                <i class="fas fa-times"></i>
            </button>

            <div class="modal-header-hero">
                <div class="modal-hero-bg" id="modalHeroBg"></div>
                <div class="modal-hero-content">
                    <h2 id="modalGameTitle">Game Name</h2>
                    <div class="modal-actions">
                        <button id="modalPlayBtn" class="modal-play-btn">
                            <i class="fas fa-play"></i> Play Now
                        </button>
                    </div>
                </div>
            </div>

            <div class="modal-body-content">
                <div class="modal-tabs">
                    <button class="modal-tab active" onclick="switchModalTab('reviews')">Reviews</button>
                    <button class="modal-tab" onclick="switchModalTab('stats')">Stats</button>
                </div>

                <div id="modal-tab-reviews" class="modal-tab-content active">
                    <div class="reviews-header">
                        <h3>User Reviews</h3>
                        <button class="write-review-btn" onclick="toggleReviewForm()">
                            <i class="fas fa-pen"></i> Write Review
                        </button>
                    </div>

                    <div id="reviewForm" class="review-form" style="display: none;">
                        <input type="text" id="reviewName" placeholder="Your Name (Optional)" maxlength="20">
                        <div class="star-rating-input">
                            <i class="far fa-star" data-rating="1" onclick="setRating(1)"></i>
                            <i class="far fa-star" data-rating="2" onclick="setRating(2)"></i>
                            <i class="far fa-star" data-rating="3" onclick="setRating(3)"></i>
                            <i class="far fa-star" data-rating="4" onclick="setRating(4)"></i>
                            <i class="far fa-star" data-rating="5" onclick="setRating(5)"></i>
                        </div>
                        <textarea id="reviewComment" placeholder="What did you think?" maxlength="140"></textarea>
                        <button onclick="submitReviewAction()">Post Review</button>
                    </div>

                    <div id="reviewsList" class="reviews-list">
                        <!-- Reviews rendered here -->
                        <div class="loading-spinner">Loading reviews...</div>
                    </div>
                </div>

                <div id="modal-tab-stats" class="modal-tab-content">
                    <div class="stats-grid">
                        <div class="stat-card">
                            <i class="fas fa-eye"></i>
                            <span id="statViews">0</span>
                            <small>Global Plays</small>
                        </div>
                        <div class="stat-card">
                            <i class="fas fa-star"></i>
                            <span id="statRating">0.0</span>
                            <small>Average Rating</small>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="toast-container fixed right-4 top-4 w-1/4">
    </div>

    <div class="toast-container"></div>

    <iframe id="contentFrame"></iframe>

    <div class="settings-container settings-hidden">
        <div class="container">
            <div class="settings-sidebar vflex">
                <div class="settings-section" style="background: var(--bg-3);" onclick="switchSettingsPage('general')"
                    data-target="general">
                    <i class="far fa-cog"></i>
                    General
                </div>
                <div class="settings-section" onclick="switchSettingsPage('gaming')" data-target="gaming">
                    <i class="far fa-gamepad-modern"></i>
                    Gaming
                </div>
                <div class="settings-section" onclick="switchSettingsPage('cloaking')" data-target="cloaks">
                    <i class="far fa-hood-cloak"></i>
                    Cloaking
                </div>
                <div class="settings-section" onclick="switchSettingsPage('proxy')" data-target="proxy">
                    <i class="far fa-globe"></i>
                    Proxy
                </div>
                <div class="settings-section" onclick="switchSettingsPage('info')" data-target="info">
                    <i class="far fa-info-circle"></i>
                    Info
                </div>
                <div class="settings-section" onclick="switchSettingsPage('updates')" data-target="info">
                    <i class="far fa-bell-on"></i>
                    Updates
                </div>
            </div>

            <div class="settings-content-container">
                <div id="settings-general" class="settings-page settings-active">
                    <h2>Theme</h2>
                    <p>The color scheme used across the whole site. Some changes might not happen instantly, so
                        refresh
                        to see those take place.</p>
                    <div class="theme-selector">
                        <div class="theme-selected"></div>
                        <div class="theme-options">

                        </div>
                    </div>

                    <h2>Fog</h2>
                    <p>Choose to enable or disable Vanta fog, which might help optimize the website.</p>
                    <!-- From Uiverse.io by Galahhad -->
                    <label class="switch">
                        <input id="pjs-toggle" checked="" onchange="updatePJS()" type="checkbox">
                        <div class="slider">
                            <div class="circle">
                                <svg class="cross" xml:space="preserve" style="enable-background:new 0 0 512 512"
                                    viewBox="0 0 365.696 365.696" y="0" x="0" height="6" width="6"
                                    xmlns:xlink="http://www.w3.org/1999/xlink" version="1.1"
                                    xmlns="http://www.w3.org/2000/svg">
                                    <g>
                                        <path data-original="#000000" fill="currentColor"
                                            d="M243.188 182.86 356.32 69.726c12.5-12.5 12.5-32.766 0-45.247L341.238 9.398c-12.504-12.503-32.77-12.503-45.25 0L182.86 122.528 69.727 9.374c-12.5-12.5-32.766-12.5-45.247 0L9.375 24.457c-12.5 12.504-12.5 32.77 0 45.25l113.152 113.152L9.398 295.99c-12.503 12.503-12.503 32.769 0 45.25L24.48 356.32c12.5 12.5 32.766 12.5 45.247 0l113.132-113.132L295.99 356.32c12.503 12.5 32.769 12.5 45.25 0l15.081-15.082c12.5-12.504 12.5-32.77 0-45.25zm0 0">
                                        </path>
                                    </g>
                                </svg>
                                <svg class="checkmark" xml:space="preserve" style="enable-background:new 0 0 512 512"
                                    viewBox="0 0 24 24" y="0" x="0" height="10" width="10"
                                    xmlns:xlink="http://www.w3.org/1999/xlink" version="1.1"
                                    xmlns="http://www.w3.org/2000/svg">
                                    <g>
                                        <path class="" data-original="#000000" fill="currentColor"
                                            d="M9.707 19.121a.997.997 0 0 1-1.414 0l-5.646-5.647a1.5 1.5 0 0 1 0-2.121l.707-.707a1.5 1.5 0 0 1 2.121 0L9 14.171l9.525-9.525a1.5 1.5 0 0 1 2.121 0l.707.707a1.5 1.5 0 0 1 0 2.121z">
                                        </path>
                                    </g>
                                </svg>
                            </div>
                        </div>
                    </label>
                    <br>
                    <br>
                </div>

                <div id="settings-gaming" class="settings-page">
                    <h2>Game Library</h2>
                    <p>The set of games that the whole site uses! This will automatically reload the games.</p>
                    <div class="store-selector">
                        <div class="store-selected"></div>
                        <div class="store-options">

                        </div>
                    </div>

                    <h2>Game Overlay</h2>
                    <p>Enable or disable the game overlay, which provides useful tools while gaming such as a
                        browser,
                        recording tools, etc. Turn off if you're experiencing performance issues.</p>
                    <!-- From Uiverse.io by Galahhad -->
                    <label class="switch">
                        <input id="overlay-toggle" checked="" onchange="updateOverlaySettings()" type="checkbox">
                        <div class="slider">
                            <div class="circle">
                                <svg class="cross" xml:space="preserve" style="enable-background:new 0 0 512 512"
                                    viewBox="0 0 365.696 365.696" y="0" x="0" height="6" width="6"
                                    xmlns:xlink="http://www.w3.org/1999/xlink" version="1.1"
                                    xmlns="http://www.w3.org/2000/svg">
                                    <g>
                                        <path data-original="#000000" fill="currentColor"
                                            d="M243.188 182.86 356.32 69.726c12.5-12.5 12.5-32.766 0-45.247L341.238 9.398c-12.504-12.503-32.77-12.503-45.25 0L182.86 122.528 69.727 9.374c-12.5-12.5-32.766-12.5-45.247 0L9.375 24.457c-12.5 12.504-12.5 32.77 0 45.25l113.152 113.152L9.398 295.99c-12.503 12.503-12.503 32.769 0 45.25L24.48 356.32c12.5 12.5 32.766 12.5 45.247 0l113.132-113.132L295.99 356.32c12.503 12.5 32.769 12.5 45.25 0l15.081-15.082c12.5-12.504 12.5-32.77 0-45.25zm0 0">
                                        </path>
                                    </g>
                                </svg>
                                <svg class="checkmark" xml:space="preserve" style="enable-background:new 0 0 512 512"
                                    viewBox="0 0 24 24" y="0" x="0" height="10" width="10"
                                    xmlns:xlink="http://www.w3.org/1999/xlink" version="1.1"
                                    xmlns="http://www.w3.org/2000/svg">
                                    <g>
                                        <path class="" data-original="#000000" fill="currentColor"
                                            d="M9.707 19.121a.997.997 0 0 1-1.414 0l-5.646-5.647a1.5 1.5 0 0 1 0-2.121l.707-.707a1.5 1.5 0 0 1 2.121 0L9 14.171l9.525-9.525a1.5 1.5 0 0 1 2.121 0l.707.707a1.5 1.5 0 0 1 0 2.121z">
                                        </path>
                                    </g>
                                </svg>
                            </div>
                        </div>
                    </label>

                    <br><br>

                    <h2>Download Games</h2>
                    <p>Download all game stores.</p>
                    <button class="button" style="margin-left: 0;" onclick="toggleDownloadGames()">Download</button>

                    <br><br><br>
                </div>

                <div id="settings-cloaking" class="settings-page">
                    <h2>Tab Cloak</h2>
                    <p>How your tab will appear in history, on filtering extensions, and more.</p>
                    <div class="decoy-selector">
                        <div class="decoy-selected"></div>
                        <div class="decoy-options">

                        </div>
                    </div>

                    <h2>about:blank</h2>
                    <p>Create a new about:blank tab to hide verdis from your history and filter.</p>
                    <button onclick="
                        openAB()
                    " class="button"><i class="ri-external-link-line"></i>&nbsp;Open in about:blank</button>
                    <br><br>
                    <h2>Auto Cloak</h2>
                    <p>If this toggle is switched on, then as soon as the page loads, it will immediately open the
                        about:blank cloaked page and redirect the main page to Google. Off by default.</p>
                    <label class="switch">
                        <input id="cloak-toggle" checked="" onchange="updateABSettings()" type="checkbox">
                        <div class="slider">
                            <div class="circle">
                                <svg class="cross" xml:space="preserve" style="enable-background:new 0 0 512 512"
                                    viewBox="0 0 365.696 365.696" y="0" x="0" height="6" width="6"
                                    xmlns:xlink="http://www.w3.org/1999/xlink" version="1.1"
                                    xmlns="http://www.w3.org/2000/svg">
                                    <g>
                                        <path data-original="#000000" fill="currentColor"
                                            d="M243.188 182.86 356.32 69.726c12.5-12.5 12.5-32.766 0-45.247L341.238 9.398c-12.504-12.503-32.77-12.503-45.25 0L182.86 122.528 69.727 9.374c-12.5-12.5-32.766-12.5-45.247 0L9.375 24.457c-12.5 12.504-12.5 32.77 0 45.25l113.152 113.152L9.398 295.99c-12.503 12.503-12.503 32.769 0 45.25L24.48 356.32c12.5 12.5 32.766 12.5 45.247 0l113.132-113.132L295.99 356.32c12.503 12.5 32.769 12.5 45.25 0l15.081-15.082c12.5-12.504 12.5-32.77 0-45.25zm0 0">
                                        </path>
                                    </g>
                                </svg>
                                <svg class="checkmark" xml:space="preserve" style="enable-background:new 0 0 512 512"
                                    viewBox="0 0 24 24" y="0" x="0" height="10" width="10"
                                    xmlns:xlink="http://www.w3.org/1999/xlink" version="1.1"
                                    xmlns="http://www.w3.org/2000/svg">
                                    <g>
                                        <path class="" data-original="#000000" fill="currentColor"
                                            d="M9.707 19.121a.997.997 0 0 1-1.414 0l-5.646-5.647a1.5 1.5 0 0 1 0-2.121l.707-.707a1.5 1.5 0 0 1 2.121 0L9 14.171l9.525-9.525a1.5 1.5 0 0 1 2.121 0l.707.707a1.5 1.5 0 0 1 0 2.121z">
                                        </path>
                                    </g>
                                </svg>
                            </div>
                        </div>
                    </label>
                    <br><br>
                    <h2>Confirm Leave</h2>
                    <p>This setting is useful if teachers are trying to close your tab. When the tab is closed, it
                        will
                        show an "Are you sure you want to leave this site?" popup to prevent tab closing.</p>
                    <label class="switch">
                        <input id="confirm-leave-toggle" checked="" onchange="updateCLSettings()" type="checkbox">
                        <div class="slider">
                            <div class="circle">
                                <svg class="cross" xml:space="preserve" style="enable-background:new 0 0 512 512"
                                    viewBox="0 0 365.696 365.696" y="0" x="0" height="6" width="6"
                                    xmlns:xlink="http://www.w3.org/1999/xlink" version="1.1"
                                    xmlns="http://www.w3.org/2000/svg">
                                    <g>
                                        <path data-original="#000000" fill="currentColor"
                                            d="M243.188 182.86 356.32 69.726c12.5-12.5 12.5-32.766 0-45.247L341.238 9.398c-12.504-12.503-32.77-12.503-45.25 0L182.86 122.528 69.727 9.374c-12.5-12.5-32.766-12.5-45.247 0L9.375 24.457c-12.5 12.504-12.5 32.77 0 45.25l113.152 113.152L9.398 295.99c-12.503 12.503-12.503 32.769 0 45.25L24.48 356.32c12.5 12.5 32.766 12.5 45.247 0l113.132-113.132L295.99 356.32c12.503 12.5 32.769 12.5 45.25 0l15.081-15.082c12.5-12.504 12.5-32.77 0-45.25zm0 0">
                                        </path>
                                    </g>
                                </svg>
                                <svg class="checkmark" xml:space="preserve" style="enable-background:new 0 0 512 512"
                                    viewBox="0 0 24 24" y="0" x="0" height="10" width="10"
                                    xmlns:xlink="http://www.w3.org/1999/xlink" version="1.1"
                                    xmlns="http://www.w3.org/2000/svg">
                                    <g>
                                        <path class="" data-original="#000000" fill="currentColor"
                                            d="M9.707 19.121a.997.997 0 0 1-1.414 0l-5.646-5.647a1.5 1.5 0 0 1 0-2.121l.707-.707a1.5 1.5 0 0 1 2.121 0L9 14.171l9.525-9.525a1.5 1.5 0 0 1 2.121 0l.707.707a1.5 1.5 0 0 1 0 2.121z">
                                        </path>
                                    </g>
                                </svg>
                            </div>
                        </div>
                    </label>
                    <br><br><br>
                </div>

                <div id="settings-proxy" class="settings-page">
                    <h2>Wisp Server</h2>
                    <p>The server that all content will be transferred through. Make sure the Wisp server you are
                        using
                        is not blocked, or the proxy will not function.</p>
                    <div class="wisp-selector">
                        <div class="wisp-selected"></div>
                        <div class="wisp-options">

                        </div>
                    </div>
                    <h2>Backend</h2>
                    <p>The main proxy service. Scramjet is newer but more experimental, while Ultraviolet is older
                        but
                        less advanced.</p>
                    <div class="backend-selector">
                        <div class="backend-selected"></div>
                        <div class="backend-options">

                        </div>
                    </div>

                    <h2>Search Engine</h2>
                    <p>This is the search engine that the proxy will use with search queries.</p>
                    <div class="search-engine-selector">
                        <div class="search-engine-selected"></div>
                        <div class="search-engine-options">

                        </div>
                    </div>

                    <br><br><br>
                </div>

                <div id="settings-info" class="settings-page">
                    <h2>Credits</h2>
                    <p>
                        <b style="font-weight: 600;">GN Math</b> - all games <br>
                        <b style="font-weight: 600;"><a href="https://waves.lat" target="_blank">Waves</a></b> -
                        custom
                        dropdown, styling
                        inspiration <br>
                        <b style="font-weight: 600;">TitaniumNetwork</b> - Ultraviolet <br>
                        <b style="font-weight: 600;">Mercury Workshop</b> - Libcurl and Scramjet <br>
                        <b style="font-weight: 600;"><a href="https://github.com/ambr0sial/nova"
                                target="_blank">Nova</a></b> - movies and TV
                        source <br>
                        <b style="font-weight: 600;"><a href="https://zxs.one" target="_blank">ZXS</a></b> - Custom
                        cursor <br>
                        <b style="font-weight: 600;">RHW, Terbium, and Anura</b> - Wisp servers <br>
                        <b style="font-weight: 600;">DevEchoX2</b> - ArrowChat <br>
                        <b style="font-weight: 600;"><a href="https://techno.pics/" target="_blank">technonyte</a></b> -
                        Emotional support <br>
                    </p>

                    <br>

                    <h2>Thank you!</h2>
                    <p>Thanks for using verdis! We hope you enjoyed your stay, and maybe star us on the <a
                            href="https://github.com/x8rr/verdis" target="_blank">repository.</a></p>
                </div>

                <div id="settings-updates" class="settings-page">
                    <h2>What's New in Release 1.1.0</h2>
                    <p class="update-cont">
                        This was actually an INSANELY big update! Check out the additions below.
                        <br><br>
                        â€¢ AI <br>
                        â€¢ Chatrooms <br>
                        â€¢ Custom Cursor (ZXS) <br>
                        â€¢ IXL cloaker thingy <br>
                        â€¢ New cloaking presets <br>
                        â€¢ Active User Count <br>
                        â€¢ New VM Service <br>
                    </p>
                </div>
            </div>

            <p class="version-tag">verdis <a href="https://github.com/x8rr/verdis/releases/latest"
                    target="_blank">stable v1.1.0</a></p>
        </div>
    </div>

    <div class="browser-container">
        <div class="browser-controls">
            <div class="tabs">
                <button class="newtab" onclick="newTab()">
                    <i class="far fa-plus"></i>
                </button>
            </div>
            <div class="browser-buttons">
                <div class="hcontainer">
                    <button onclick="b()">
                        <i class="far fa-chevron-left"></i>
                    </button>
                    <button onclick="f()">
                        <i class="far fa-chevron-right"></i>
                    </button>
                    <button onclick="r()">
                        <i class="far fa-rotate-right"></i>
                    </button>
                    <input type="text" id="searchbar" onkeydown="((e) => {
                        if (e.key === 'Enter' || e.key === 'enter') {
                            console.log('hi')
                            rSearch(this.value.trim())
                        }
                    })" placeholder="search anything...">
                    <button onclick="full()">
                        <i class="far fa-expand"></i>
                    </button>
                    <button onclick="launchEruda()">
                        <i class="far fa-square-code"></i>
                    </button>
                    <button onclick="hideBrowser()">
                        <i class="far fa-house"></i>
                    </button>
                </div>
            </div>
        </div>
        <div class="browser-loading"></div>
    </div>

    <div id="vanta-fog-container"></div>
    <div id="particles-container"></div>

    <div id="cursor-thank-you-zxs"
        style="position: fixed; top: 0px; left: 0px; width: 16px; height: 16px; border-radius: 50%; background: color-mix(in srgb, var(--accent) 70%, white 30%); pointer-events: none; z-index: 9999; transform: translate(748px, 592px); transition: width 0.15s, height 0.15s, opacity 0.15s; mix-blend-mode: difference; opacity: 0;">
    </div>

    <div class="apps-wrapper settings-hidden">
        <input onkeyup="searchApps(this.value)" type="text" style="font-family: Arial;"
            placeholder="search through the apps..." id="apps-search"
            class="h-fit p-4 px-5 w-[975px] bg-[var(--bg-2)] border-none absolute left-1/2 translate-x-[-50%] rounded-2xl transition-all focus:bg-[var(--bg-3)] focus:outline-none ">
        <br><br><br>
        <div
            class="apps-container h-[83%] overflow-y-scroll w-[475px] flex flex-wrap w-7/8 absolute left-1/2 translate-x-[-50%] justify-center">
            <br>
        </div>
        <br>
    </div>

    <div class="download-wrapper settings-hidden">
        <div style="text-align: center;">
            <br>
            <h1 style="font-size: 23px; margin-bottom: 10px;">Download Games</h1>
        </div>
        <div style="text-align: center;">
            <a href="https://drive.google.com/file/d/1jenQFXTxrgbNqfLYzH7ckVEC_hskECl1/view?usp=sharing"
                target="_blank">
                <button class="button">Google Drive 1</button>
            </a>
        </div>
        <br>
        <p style="opacity: .5; font-size: 14px; font-style: italic; text-align: center; ">more coming before gta 6
            twin
            <br> :broken-heart: :wilted-rose: :low-battery:
        </p>
    </div>

    <div class="games-wrapper settings-hidden">
        <input onkeyup="searchApps(this.value)" type="text" style="font-family: Arial;"
            placeholder="search through the games..." id="apps-search"
            class="h-fit p-4 px-5 w-[975px] bg-[var(--bg-2)] border-none absolute left-1/2 translate-x-[-50%] rounded-2xl transition-all focus:bg-[var(--bg-3)] focus:outline-none ">
        <br><br><br>
        <div
            class="games-container h-[83%] overflow-y-scroll w-[475px] flex flex-wrap w-7/8 absolute left-1/2 translate-x-[-50%] justify-center">
            <br>
        </div>
        <br>
    </div>

    <div class="partners-wrapper settings-hidden">
        <br>
        <h1 style="text-align: center; font-size: 35px; color: var(--bright-text); font-weight: 500;">Partners</h1>
        <br>
        <div
            class="partner-container h-[83%] overflow-y-scroll w-[475px] flex flex-wrap w-7/8 absolute left-1/2 translate-x-[-50%] justify-center">
            <a href="https://prism.onl/" target="_blank" class="app partner-square">
                <div class="bg-img" style="background: url('/assets/img/partners/prism.png');"></div>
                <div class="app-title-cont">
                    <h2 class="app-title-h2">Prism</h2>
                </div>
            </a>

            <a href="https://github.com/Galaxy-Vortex/" target="_blank" class="app partner-square">
                <div class="bg-img" style="background: url('/assets/img/partners/hydra.png');"></div>
                <div class="app-title-cont">
                    <h2 class="app-title-h2">Hydra Network</h2>
                </div>
            </a>
        </div>
    </div>

    <button id="reset-theme" onclick="resetTheme()">CLICK HERE TO RESET YOUR THEME!</button>

    <!-- site version -->
    <verdisattr version="s1.1.0"></verdisattr>

    <script src="/assets/js/dropdown.js"></script>
    <script>
        const pjsOn = localStorage.getItem("verdis_particlesOn") ?? "yes"

        if (pjsOn === "yes") {
            particlesJS.load("particles-container", "/assets/json/config/particles.json", () => {
                console.log("callback - particlsjs loaded")
            })
        } else {
            console.log("ParticlesJS is off!")
        }
    </script>
    <script>
        const selectedStore = localStorage.getItem("verdis_gameStore") ?? "GN-Math"

        let res
        let data

        async function gj(file) {
            res = await fetch(`/assets/json/${file}.json`);
            data = await res.json()
        }

        // welcome to my super bad json loader
        // time wasted on this:
        // 0.25 hour(s)

        function slugify(text) {
            if (!text) return '';
            return text.toString().toLowerCase()
                .replace(/\s+/g, '-')
                .replace(/[^\w\-]+/g, '')
                .replace(/\-\-+/g, '-')
                .replace(/^-+/, '')
                .replace(/-+$/, '');
        }

        async function load(file, type, functionName, toRun, additions) {
            // For games, first load recommendations
            if (type === 'games') {
                try {
                    const recRes = await fetch('/assets/json/recommendations.json');
                    if (recRes.ok) {
                        const recommendations = await recRes.json();
                        console.log('Recommendations loaded:', recommendations.length);
                        
                        // Render recommendations first
                        recommendations.forEach(item => {
                            const aCont = document.querySelector(`.${type}-container`)
                            const newAppContainer = document.createElement("div")

                            newAppContainer.classList.add("app")
                            newAppContainer.setAttribute("data-name", item.name)
                            newAppContainer.setAttribute("data-type", type)
                            newAppContainer.setAttribute("data-url", item.url)
                            newAppContainer.setAttribute("data-img", item.img)

                            const isFav = VerdiFavorites.isFavorite(type, item.name)

                            const clickHandler = `
                                if(typeof VerdisBackend !== 'undefined') {
                                    VerdisBackend.trackPlay('${slugify(item.name)}', '${item.name.replace(/'/g, "\\'")}');
                                }
                                console.log("Launching game: ${item.name.replace(/'/g, "\\'")}");
                                toggleGames();
                                navTo('play.html?launch=' + encodeURIComponent('${item.url}') + '${item.embed ? '&embed=true' : ''}', '${item.name.replace(/'/g, "\\'")}');
                            `.replace(/\s+/g, ' ');

                            newAppContainer.setAttribute("onclick", clickHandler)

                            newAppContainer.innerHTML = `
                                <button class="favorite-btn ${isFav ? 'active' : ''}" onclick="event.stopPropagation(); toggleFavoriteCard(this, '${type}', ${JSON.stringify(item).replace(/"/g, '&quot;')})">
                                    <i class="${isFav ? 'fas' : 'far'} fa-heart"></i>
                                </button>
                                <button class="info-btn" onclick="event.stopPropagation(); openGameDetails('${type}', ${JSON.stringify(item).replace(/"/g, '&quot;')})">
                                    <i class="fas fa-info-circle"></i>
                                </button>
                                <div class="bg-img" data-bg="${item.img}"></div>
                                <div class="app-title-cont">
                                    <h2 class="app-title-h2">${item.name}</h2>
                                </div>
                            `

                            aCont.appendChild(newAppContainer)
                        });
                    }
                } catch (err) {
                    console.warn("Failed to load recommendations:", err);
                }
            }

            // Then load the main content
            gj(file).then(() => {
                console.log(
                    "%cverdis" + "%c recieved json data!",
                    "color: white; background: linear-gradient(to bottom right, #040c16, #000000); border-radius: 5px; font-weight: bold; padding: 6px; font-family: sans-serif;",
                    "color: white; background: transparent; border-radius: 0px; padding: 0px;"
                )
            }).then(() => {
                data.forEach(item => {
                    const aCont = document.querySelector(`.${type}-container`)
                    const newAppContainer = document.createElement("div")

                    newAppContainer.classList.add("app")
                    newAppContainer.setAttribute("data-name", item.name)
                    newAppContainer.setAttribute("data-type", type)
                    newAppContainer.setAttribute("data-url", item.url)
                    newAppContainer.setAttribute("data-img", item.img)

                    // Check if favorited
                    const isFav = VerdiFavorites.isFavorite(type, item.name)

                    // Helper to track play then handle navigation
                    let clickHandler;
                    if (type === 'games') {
                        clickHandler = `
                            if(typeof VerdisBackend !== 'undefined') {
                                VerdisBackend.trackPlay('${slugify(item.name)}', '${item.name.replace(/'/g, "\\'")}');
                            }
                            console.log("Launching game: ${item.name.replace(/'/g, "\\'")}");
                            toggleGames();
                            navTo('play.html?launch=' + encodeURIComponent('${item.url}') + '${item.embed ? '&embed=true' : ''}', '${item.name.replace(/'/g, "\\'")}');
                        `.replace(/\s+/g, ' ');
                    } else {
                        // Apps: check if direct flag is set
                        if (item.direct) {
                            // Direct navigation to the page
                            clickHandler = `
                                console.log("Launching app directly: ${item.name.replace(/'/g, "\\'")}");
                                toggleApps();
                                window.location.href = '${item.url}';
                            `.replace(/\s+/g, ' ');
                        } else {
                            // Use rSearch to load through proxy/browser
                            clickHandler = `
                                console.log("Launching app: ${item.name.replace(/'/g, "\\'")}");
                                toggleApps();
                                rSearch('${item.url}');
                            `.replace(/\s+/g, ' ');
                        }
                    }

                    newAppContainer.setAttribute("onclick", clickHandler)

                    newAppContainer.innerHTML = `
                        <button class="favorite-btn ${isFav ? 'active' : ''}" onclick="event.stopPropagation(); toggleFavoriteCard(this, '${type}', ${JSON.stringify(item).replace(/"/g, '&quot;')})">
                            <i class="${isFav ? 'fas' : 'far'} fa-heart"></i>
                        </button>
                        <button class="info-btn" onclick="event.stopPropagation(); openGameDetails('${type}', ${JSON.stringify(item).replace(/"/g, '&quot;')})">
                            <i class="fas fa-info-circle"></i>
                        </button>
                        <div class="bg-img" data-bg="${item.img}"></div>
                        <div class="app-title-cont">
                            <h2 class="app-title-h2">${item.name}</h2>
                        </div>
                    `

                    aCont.appendChild(newAppContainer)
                })
            }).then(() => {
                observe()
            })
        }

        // Toggle favorite from card button
        function toggleFavoriteCard(btn, type, item) {
            const isFav = VerdiFavorites.toggleFavorite(type, {
                id: item.name,
                name: item.name,
                img: item.img,
                url: item.url
            })

            const icon = btn.querySelector('i')
            if (isFav) {
                // Add animation class for burst effect
                btn.classList.add('animating')
                setTimeout(() => btn.classList.remove('animating'), 500)

                btn.classList.add('active')
                icon.classList.remove('far')
                icon.classList.add('fas')
                showToast('success', `Added "${item.name}" to favorites!`, 'fas fa-heart')
            } else {
                btn.classList.remove('active')
                icon.classList.remove('fas')
                icon.classList.add('far')
                showToast('success', `Removed "${item.name}" from favorites`, 'far fa-heart')
            }

            renderQuickAccess()
        }

        // Render Quick Access section
        function renderQuickAccess() {
            const section = document.getElementById('quickAccessSection')
            const container = document.getElementById('quickAccessContainer')
            const favorites = VerdiFavorites.getAllFavorites(6)

            if (favorites.length === 0) {
                section.style.display = 'none'
                return
            }

            section.style.display = 'block'
            container.innerHTML = ''

            favorites.forEach(fav => {
                const item = document.createElement('div')
                item.className = 'quick-access-item'
                item.innerHTML = `
                    <span class="type-badge">${fav.type === 'games' ? 'ðŸŽ®' : fav.type === 'apps' ? 'ðŸ“±' : 'ðŸŽ¬'}</span>
                    <div class="bg-img" style="background-image: url('${fav.img}')"></div>
                    <span class="item-title">${fav.name}</span>
                    <button class="remove-fav" onclick="event.stopPropagation(); removeFavoriteQuick('${fav.type}', '${fav.name}')">
                        <i class="fas fa-times"></i>
                    </button>
                `

                // Click to open
                item.addEventListener('click', () => {
                    if (fav.type === 'games') {
                        navTo('play.html?launch=' + fav.url, fav.name)
                    } else if (fav.type === 'apps') {
                        rSearch(fav.url)
                    } else if (fav.type === 'movies') {
                        navTo('movies')
                    }
                })

                container.appendChild(item)
            })
        }

        // Remove from Quick Access
        function removeFavoriteQuick(type, name) {
            VerdiFavorites.removeFavorite(type, name)
            showToast('success', `Removed "${name}" from favorites`, 'far fa-heart')
            renderQuickAccess()

            // Also update card button if visible
            const card = document.querySelector(`.app[data-name="${name}"][data-type="${type}"]`)
            if (card) {
                const btn = card.querySelector('.favorite-btn')
                if (btn) {
                    btn.classList.remove('active')
                    btn.querySelector('i').classList.replace('fas', 'far')
                }
            }
        }

        const bgO = new IntersectionObserver(cards => {
            cards.forEach(c => {
                if (c.isIntersecting) {
                    const el = c.target
                    el.style.backgroundImage = `url('${el.dataset.bg}')`
                    bgO.unobserve(el)
                }
            })
        })


        function observe() {
            document.querySelectorAll(".bg-img[data-bg]").forEach(el => bgO.observe(el))
        }

        // Moved load() calls to after SW registration to ensure proxy is ready

        document.addEventListener("DOMContentLoaded", () => {
            // Initial UI setup
            const loading = document.querySelector(".loading")
            if (loading) {
                loading.style.opacity = 0
                loading.style.pointerEvents = "none"
            }
        })

        // Handle favorites updated (including auto-removed items)
        window.addEventListener('favoritesUpdated', (e) => {
            if (e.detail.removedItem) {
                // An old favorite was auto-removed to make room
                showToast('info', `Removed "${e.detail.removedItem.name}" to make room`, 'fas fa-info-circle')

                // Update the UI for the removed item's card
                const removedCard = document.querySelector(`.app[data-name="${e.detail.removedItem.name}"][data-type="${e.detail.removedItem.type}"]`)
                if (removedCard) {
                    const btn = removedCard.querySelector('.favorite-btn')
                    if (btn) {
                        btn.classList.remove('active')
                        btn.querySelector('i').classList.replace('fas', 'far')
                    }
                }
            }
        })

        document.addEventListener("storeUpdated", (e) => {
            const newStore = e.detail.toLowerCase()
            const container = document.querySelector(".games-container")

            container.innerHTML = ''
            load(newStore, "games", "Games", "navTo", "play.html?launch=")
        })

        function searchApps(term) {
            const apps = document.querySelectorAll(".app")
            apps.forEach((app) => {
                if (!app.querySelector("h2").textContent.toLowerCase().includes(term.toLowerCase())) {
                    app.style.display = "none"
                } else {
                    app.style.display = "block"
                }
            })
        }
    </script>
    <script>
        async function waitForSW() {
            if (!("serviceWorker" in navigator)) return;
            if (navigator.serviceWorker.controller) return;

            return new Promise(resolve => {
                navigator.serviceWorker.addEventListener('controllerchange', () => {
                    resolve();
                }, { once: true });
            });
        }

        async function registerSW() {
            console.log("Verdis: Initializing Service Workers...");
            if ("serviceWorker" in navigator) {
                try {
                    await navigator.serviceWorker.register("/uv/sw.js", {
                        scope: '/uv/service/'
                    });
                    console.log("Verdis: UV SW Registered");

                    await navigator.serviceWorker.register("/sw.js", {
                        scope: '/'
                    });
                    console.log("Verdis: Main SW Registered");

                    // Reload if no controller (first load) ensuring immediate control
                    if (!navigator.serviceWorker.controller) {
                        // We can try to reload or just wait? 
                        // Usually new SWs claim clients. Let's assume they DO in their install/activate.
                        // But if not, we might need a hard reload. 
                        // For now, let's proceed but logged.
                        console.log("Verdis: Waiting for SW controller...");
                        await waitForSW();
                        console.log("Verdis: SW Controller active");
                    }

                    showToast("success", "Service Workers Ready", "fas fa-check-circle");

                    // LOAD CONTENT NOW
                    console.log("Verdis: Loading Content...");
                    load("apps", "apps", "Apps", "rSearch", "")
                    load(selectedStore.toLowerCase(), "games", "Games", "navTo", "play.html?launch=")

                    observe()
                    setTimeout(renderQuickAccess, 100)

                    // Init Umami now that proxy is ready
                    initUmami();

                    // Start User Count (safe now)
                    getActiveUsers();
                    setInterval(() => getActiveUsers(), 30000);

                    document.querySelector(".loading").style.opacity = 0
                    document.querySelector(".loading").style.pointerEvents = "none"
                    document.querySelector("#homesearch").disabled = false
                    document.querySelector("#homesearch").placeholder = "search anything..."

                } catch (e) {
                    console.error("Verdis: SW Registration Failed", e);
                    showToast("error", "Failed to register Service Worker", "fas fa-times-circle");
                    // Still try to load? content might fail
                    load("apps", "apps", "Apps", "rSearch", "")
                    load(selectedStore.toLowerCase(), "games", "Games", "navTo", "play.html?launch=")
                }
            }
        }

        function initUmami() {
            const uScript = document.createElement('script');
            uScript.defer = true;
            uScript.dataset.websiteId = "aa852720-724b-4441-be4c-6db9ef160eb9";

            let src = "https://cloud.umami.is/script.js";
            if (typeof __uv$config !== 'undefined') {
                try {
                    src = __uv$config.prefix + __uv$config.encodeUrl(src);
                    console.log("Loading Umami via Proxy");
                } catch (e) { console.error("UV encode failed", e); }
            }



            uScript.src = src;
            document.head.appendChild(uScript);
        }

        async function getActiveUsers() {
            try {
                let endpoint = "https://api.x8r.dev/api/umami"
                if (typeof __uv$config !== 'undefined') {
                    endpoint = __uv$config.prefix + __uv$config.encodeUrl(endpoint);
                }
                const res = await fetch(endpoint)
                if (!res.ok) throw new Error("Fetch failed");
                const data = await res.json()
                console.log("CURRENT VISITORS:" + data.visitors)
                const userCountEl = document.getElementById("user-count")
                if (userCountEl) userCountEl.textContent = data.visitors
            } catch (e) { console.error("Visitors fetch error", e); }
        }

        window.addEventListener("load", () => {
            registerSW();
            lucide.createIcons();
        });


        const contentFrame = document.getElementById('contentFrame');
        const homeContent = document.getElementById('homeContent');
        const navLinks = document.querySelectorAll('nav a[data-page]');

        function navTo(l, name = null) {
            // Track activity based on destination
            if (typeof VerdisPlaytime !== 'undefined') {
                if (l.includes("play.html") || l.includes("/stores/")) {
                    VerdisPlaytime.trackActivity('games', name || l.split('/').pop().replace('.html', ''));
                } else if (l === "movies") {
                    VerdisPlaytime.trackActivity('movies');
                } else if (l.includes("home")) {
                    VerdisPlaytime.trackActivity('idle');
                }
            }

            const nav = document.getElementById("main-nav");

            // Close any open settings panels / overlays logic
            // We do this for both home and game navigation to be sure
            const panels = document.querySelectorAll('.settings-shown');
            panels.forEach(p => {
                p.classList.remove('settings-shown');
                p.classList.add('settings-hidden');
            });
            const blur = document.querySelector('.blurOverlay');
            if (blur) blur.remove();

            // Also ensure body class is cleaned up if we are closing things
            // But game interaction might want content-open? 
            // The toggles add content-open. navTo(home) removes it. navTo(game) adds it.
            // So we handle it below.

            if (l.includes("home")) {
                // remove class first to unlock visibility
                document.body.classList.remove("content-open");
                document.body.classList.remove("game-active");

                if (nav) {
                    nav.classList.remove("nav-minimized");
                    nav.style.display = "block";
                    nav.style.opacity = "1";
                }

                if (contentFrame) contentFrame.remove();
                if (homeContent) homeContent.style.display = "block";

                // RESTORE BACKGROUND - EXIT GAME MODE
                if (typeof exitGameMode === 'function') {
                    exitGameMode();
                }

            } else {
                document.body.classList.add("content-open");
                document.body.classList.add("game-active");

                if (nav) {
                    nav.classList.add("nav-minimized");
                }

                let cFrame = document.getElementById('contentFrame');
                if (!cFrame) {
                    cFrame = document.createElement('iframe');
                    cFrame.id = 'contentFrame';
                    document.body.appendChild(cFrame);
                } else if (!document.body.contains(cFrame)) {
                    document.body.appendChild(cFrame);
                }

                // ENTER GAME MODE
                if (typeof enterGameMode === 'function') {
                    enterGameMode();
                }

                if (homeContent) homeContent.style.display = "none";
                cFrame.style.display = "block";

                let target = l;
                if (l.includes("/stores/")) {
                    target = `/pages/${l}`;
                } else if (l.endsWith('.html') || l.includes('.html?')) {
                    target = `/pages/${l}`;
                } else {
                    target = `/pages/${l}.html`;
                }
                cFrame.src = target;
            }
        }

        // Nav Morph Hover Logic
        (function () {
            const nav = document.getElementById("main-nav");
            let minimizeTimeout = null;

            if (nav) {
                nav.addEventListener("mouseenter", () => {
                    if (nav.classList.contains("nav-minimized")) {
                        nav.classList.add("nav-hover-expand");
                        if (minimizeTimeout) {
                            clearTimeout(minimizeTimeout);
                            minimizeTimeout = null;
                        }
                    }
                });

                nav.addEventListener("mouseleave", () => {
                    if (nav.classList.contains("nav-minimized") && nav.classList.contains("nav-hover-expand")) {
                        minimizeTimeout = setTimeout(() => {
                            nav.classList.remove("nav-hover-expand");
                            minimizeTimeout = null;
                        }, 3000);
                    }
                });
            }
        })();
    </script>
    <script defer>
        window.addEventListener("load", () => {
            const frames = document.querySelectorAll(".viewframe")
            const activeFrames = document.querySelectorAll(".active")

            activeFrames.forEach(frame => {
                frame.classList.remove("active")
            })
        })
    </script>
    <script defer>
        const settingsHolder = document.querySelector(".settings-container")
        const settingsViewframe = document.querySelector(".settings-content-container")

        const appsHolder = document.querySelector(".apps-wrapper")
        const gamesHolder = document.querySelector(".games-wrapper")
        const downloadHolder = document.querySelector(".download-wrapper")
        const partnerHolder = document.querySelector(".partners-wrapper")

        const general = document.querySelector("#settings-general")
        const cloaking = document.querySelector("#settings-cloaking")
        const proxy = document.querySelector("#settings-proxy")
        const cookes = document.querySelector("#settings-cookies")
        const info = document.querySelector("#settings-info")

        const allPages = document.querySelectorAll(".settings-page")
        const allButtons = document.querySelectorAll(".settings-section")

        function switchSettingsPage(target) {
            allPages.forEach(page => {
                page?.classList.remove("settings-active")
                document.querySelector(`#settings-${target}`)?.classList.add("settings-active")
            })
        }

        allButtons.forEach(button => {
            button.addEventListener("click", () => {
                allButtons.forEach(btn => {
                    btn.style.background = ""
                    button.style.background = "var(--bg-3)"
                })
            })
        })

        function toggleSettings() {
            if (settingsHolder.classList.contains("settings-hidden") && !settingsHolder.classList.contains("genie-opening")) {
                if (appsHolder.classList.contains("settings-shown")) {
                    toggleApps()
                } else if (gamesHolder.classList.contains("settings-shown")) {
                    toggleGames()
                } else if (partnerHolder.classList.contains("settings-shown")) {
                    togglePartners()
                } else if (downloadHolder.classList.contains("settings-shown")) {
                    toggleDownloadGames()
                }

                // Calculate button position for genie effect
                const settingsBtn = document.querySelector('[data-page="dc"]');
                if (settingsBtn) {
                    const btnRect = settingsBtn.getBoundingClientRect();
                    const centerX = btnRect.left + btnRect.width / 2;
                    const offsetX = centerX - window.innerWidth / 2;
                    settingsHolder.style.setProperty('--genie-offset-x', `${offsetX}px`);
                }

                const newBlurOverlay = document.createElement("div")
                newBlurOverlay.classList.add("blurOverlay")
                document.body.appendChild(newBlurOverlay)
                newBlurOverlay.addEventListener("click", () => {
                    toggleSettings()
                })
                settingsHolder.classList.remove("settings-hidden")
                settingsHolder.classList.add("genie-opening")
                document.body.classList.add("content-open")

                // After animation, switch to settings-shown
                setTimeout(() => {
                    settingsHolder.classList.remove("genie-opening");
                    settingsHolder.classList.add("settings-shown");
                }, 500);
            } else if (settingsHolder.classList.contains("settings-shown")) {
                // Genie collapse animation
                settingsHolder.classList.add('genie-closing');
                settingsHolder.classList.remove("settings-shown");
                setTimeout(() => {
                    settingsHolder.classList.remove('genie-closing');
                    settingsHolder.classList.add("settings-hidden");
                }, 450);
                document.body.classList.remove("content-open")
                const newBlurOverlay = document.querySelector(".blurOverlay")
                if (newBlurOverlay) newBlurOverlay.remove()
            }
        }
        function toggleApps() {
            if (appsHolder.classList.contains("settings-hidden") && !appsHolder.classList.contains("genie-opening")) {
                if (settingsHolder.classList.contains("settings-shown")) {
                    toggleSettings()
                } else if (gamesHolder.classList.contains("settings-shown")) {
                    toggleGames()
                } else if (partnerHolder.classList.contains("settings-shown")) {
                    togglePartners()
                } else if (downloadHolder.classList.contains("settings-shown")) {
                    toggleDownloadGames()
                }

                // Calculate button position for genie effect
                const appsBtn = document.querySelector('[data-page="apps"]');
                if (appsBtn) {
                    const btnRect = appsBtn.getBoundingClientRect();
                    const centerX = btnRect.left + btnRect.width / 2;
                    const offsetX = centerX - window.innerWidth / 2;
                    appsHolder.style.setProperty('--genie-offset-x', `${offsetX}px`);
                }

                const newBlurOverlay = document.createElement("div")
                newBlurOverlay.classList.add("blurOverlay")
                document.body.appendChild(newBlurOverlay)
                newBlurOverlay.addEventListener("click", () => {
                    toggleApps()
                })
                document.body.classList.add('content-open')
                appsHolder.classList.remove("settings-hidden")
                appsHolder.classList.add("genie-opening")

                // After animation, switch to settings-shown
                setTimeout(() => {
                    appsHolder.classList.remove("genie-opening");
                    appsHolder.classList.add("settings-shown");
                }, 600);

                console.log("Apps toggled.")
            } else if (appsHolder.classList.contains("settings-shown")) {
                document.body.classList.remove('content-open')
                // Genie collapse animation
                appsHolder.classList.add('genie-closing');
                appsHolder.classList.remove("settings-shown");
                setTimeout(() => {
                    appsHolder.classList.remove('genie-closing');
                    appsHolder.classList.add("settings-hidden");
                }, 500);
                document.body.classList.remove("content-open")
                const newBlurOverlay = document.querySelector(".blurOverlay")
                if (newBlurOverlay) newBlurOverlay.remove()
            }
        }

        function toggleDownloadGames() {
            if (downloadHolder.classList.contains("settings-hidden")) {
                if (appsHolder.classList.contains("settings-shown")) {
                    toggleApps()
                } else if (gamesHolder.classList.contains("settings-shown")) {
                    toggleGames()
                } else if (partnerHolder.classList.contains("settings-shown")) {
                    togglePartners()
                } else if (settingsHolder.classList.contains("settings-shown")) {
                    toggleSettings()
                }
                const newBlurOverlay = document.createElement("div")
                newBlurOverlay.classList.add("blurOverlay")
                document.body.appendChild(newBlurOverlay)
                newBlurOverlay.addEventListener("click", () => {
                    toggleDownloadGames()
                })
                downloadHolder.classList.remove("settings-hidden")
                downloadHolder.classList.add("settings-shown")
                document.body.classList.add("content-open")
                console.log("Apps toggled.")
            } else {
                downloadHolder.classList.remove("settings-shown")
                downloadHolder.classList.add("settings-hidden")
                document.body.classList.remove("content-open")
                const newBlurOverlay = document.querySelector(".blurOverlay")
                newBlurOverlay.remove()
            }
        }

        function toggleGames() {
            if (gamesHolder.classList.contains("settings-hidden") && !gamesHolder.classList.contains("genie-opening")) {
                if (appsHolder.classList.contains("settings-shown")) {
                    toggleApps()
                } else if (settingsHolder.classList.contains("settings-shown")) {
                    toggleSettings()
                } else if (partnerHolder.classList.contains("settings-shown")) {
                    togglePartners()
                } else if (downloadHolder.classList.contains("settings-shown")) {
                    toggleDownloadGames()
                }

                // Calculate button position for genie effect
                const gamesBtn = document.querySelector('[data-page="games"]');
                if (gamesBtn) {
                    const btnRect = gamesBtn.getBoundingClientRect();
                    const centerX = btnRect.left + btnRect.width / 2;
                    const offsetX = centerX - window.innerWidth / 2;
                    gamesHolder.style.setProperty('--genie-offset-x', `${offsetX}px`);
                }

                const newBlurOverlay = document.createElement("div")
                newBlurOverlay.classList.add("blurOverlay")
                document.body.appendChild(newBlurOverlay)
                newBlurOverlay.addEventListener("click", () => {
                    console.log("clicked")
                    toggleGames()
                })

                // Ensure blur is visible immediately, before and during animation
                newBlurOverlay.style.opacity = "1";

                document.body.classList.add('content-open')
                gamesHolder.classList.remove("settings-hidden")
                gamesHolder.classList.add("genie-opening")

                // After animation, switch to settings-shown
                setTimeout(() => {
                    gamesHolder.classList.remove("genie-opening");
                    gamesHolder.classList.add("settings-shown");
                }, 600);
            } else if (gamesHolder.classList.contains("settings-shown")) {
                document.body.classList.remove('content-open')
                // Genie collapse animation
                gamesHolder.classList.add('genie-closing');
                gamesHolder.classList.remove("settings-shown");
                setTimeout(() => {
                    gamesHolder.classList.remove('genie-closing');
                    gamesHolder.classList.add("settings-hidden");
                }, 500);
                const newBlurOverlay = document.querySelector(".blurOverlay")
                if (newBlurOverlay) newBlurOverlay.remove()
            }
        }

        function togglePartners() {
            if (partnerHolder.classList.contains("settings-hidden")) {
                if (appsHolder.classList.contains("settings-shown")) {
                    toggleApps()
                } else if (settingsHolder.classList.contains("settings-shown")) {
                    toggleSettings()
                } else if (gamesHolder.classList.contains("settings-shown")) {
                    toggleGames()
                } else if (downloadHolder.classList.contains("settings-shown")) {
                    toggleDownloadGames()
                }
                const newBlurOverlay = document.createElement("div")
                newBlurOverlay.classList.add("blurOverlay")
                document.body.appendChild(newBlurOverlay)
                newBlurOverlay.addEventListener("click", () => {
                    console.log("clicked")
                    togglePartners()
                })
                partnerHolder.classList.remove("settings-hidden")
                partnerHolder.classList.add("settings-shown")
                document.body.classList.add("content-open")
            } else {
                partnerHolder.classList.remove("settings-shown")
                partnerHolder.classList.add("settings-hidden")
                document.body.classList.remove("content-open")
                const newBlurOverlay = document.querySelector(".blurOverlay")
                newBlurOverlay.remove()
            }
        }

        function rSearch(input) {
            // Track browsing/apps activity
            if (typeof VerdisPlaytime !== 'undefined') {
                VerdisPlaytime.trackActivity('browsing');
            }

            const aw = document.querySelector(".apps-wrapper")

            if (aw.classList.contains("settings-shown")) {
                // Track as apps since coming from apps panel
                if (typeof VerdisPlaytime !== 'undefined') {
                    VerdisPlaytime.trackActivity('apps');
                }
                toggleApps()
            }

            let url = input;
            if (!url.includes(".") || url.includes(" ")) {
                url = url;
            } else {
                if (!url.startsWith("http://") && !url.startsWith("https://")) {
                    url = "https://" + url;
                }
            }

            const b = document.querySelector(".browser-container")
            const frames = document.querySelectorAll(".viewframe")

            b.style.opacity = 1
            b.style.pointerEvents = "all"
            document.body.classList.add('browser-active')

            frames.forEach(frame => {
                frame.style.opacity = 1
                frame.style.pointerEvents = "all"
            })

            console.log("rSearch")
            if (typeof enterGameMode === 'function') {
                enterGameMode();
            }
            newTab()
            nav(url)
            switchTab(aTab)
        }
    </script>
    <script defer>
        window.addEventListener("DOMContentLoaded", () => {
            console.log("verdis: dom content loaded")
            const homesearch = document.getElementById("homesearch");

            homesearch.addEventListener("keydown", (e) => {
                console.log("askjdfaskhjlgdf")
                if (e.key === "Enter") {
                    rSearch(homesearch?.value.trim());
                    console.log("rsearching")
                }
                console.log("check")
            });
        })
    </script>
    <script defer>
        const pjstoggle = document.getElementById("pjs-toggle")
        const pcont = document.getElementById("vanta-fog-container")
        const pjsIsOn = localStorage.getItem("verdis_particlesOn") ?? "yes"

        function updatePJS() {
            if (pjstoggle.checked) {
                console.log("checked")
                let newpjs = document.getElementById("vanta-fog-container")
                if (!newpjs) {
                    newpjs = document.createElement("div")
                    newpjs.setAttribute("id", "vanta-fog-container")
                    document.body.append(newpjs)
                }
                localStorage.setItem("verdis_particlesOn", "yes")
                if (window.vantaEffect) window.vantaEffect.destroy()
                window.vantaEffect = VANTA.FOG({
                    el: "#vanta-fog-container",
                    mouseControls: true,
                    touchControls: true,
                    gyroControls: false,
                    minHeight: 200.00,
                    minWidth: 200.00,
                    highlightColor: hexToNumber(cssVar("--accent")),
                    midtoneColor: hexToNumber(cssVar("--bg-2")),
                    lowlightColor: hexToNumber(cssVar("--bg-5")),
                    baseColor: hexToNumber(cssVar("--bg")),
                    blurFactor: 0.90,
                    speed: 1
                })
                showToast("success", "Vanta is now on!", "fas fa-check-circle")
            } else {
                const newpcont = document.getElementById("vanta-fog-container")
                if (newpcont) newpcont.remove()
                if (window.vantaEffect) {
                    window.vantaEffect.destroy()
                    window.vantaEffect = null
                }
                console.log("unchecked")
                localStorage.setItem("verdis_particlesOn", "no")
                showToast("success", "Vanta is now off!", "fas fa-check-circle")
            }
        }

        if (pjsIsOn === "yes") {
            pjstoggle.checked = true
        } else {
            pjstoggle.checked = false
        }
    </script>
    <script defer>
        const overlayToggle = document.getElementById("overlay-toggle")
        const overlayIsOn = localStorage.getItem("verdis_useOverlay") ?? "yes"

        function updateOverlaySettings() {
            if (overlayToggle.checked) {
                console.log("checked")
                showToast("success", "Game overlay is now on!", "fas fa-check-circle")
                localStorage.setItem("verdis_useOverlay", "yes")
            } else {
                console.log("unchecked")
                localStorage.setItem("verdis_useOverlay", "no")
                showToast("success", "Game overlay is now off!", "fas fa-check-circle")
            }
        }

        if (overlayIsOn === "yes") {
            overlayToggle.checked = true
        } else {
            overlayToggle.checked = false
        }
    </script>
    <script defer>
        const verdisAttr = document.querySelector("verdisattr")
        const siteVersion = verdisAttr.getAttribute("version")
        const savedVer = localStorage.getItem("verdis_siteVersion") ?? ""

        window.addEventListener("DOMContentLoaded", () => {
            if (savedVer === null || !savedVer) {
                showToast("success", "Welcome to verdis!", "fas fa-hand-wave")
                localStorage.setItem("verdis_siteVersion", siteVersion)
            } else if (savedVer !== siteVersion) {
                showToast("success", "verdis was updated! Check settings for more info.", "fas fa-check-circle")
                localStorage.setItem("verdis_siteVersion", siteVersion)
            }
        })

        function resetTheme() {
            localStorage.setItem("verdis_theme", "default")
            window.location.reload()
        }

        function openAB() {
            if (window.self !== window.top) return

            const CLOAK_REDIRECT = "https://google.com/"
            const BLOB_URL_CLEANUP_DELAY_MS = 5000
            const targetUrl = window.location.href
            const iframeUrl = new URL(targetUrl, window.location.href).toString()
            let cloakWin = window.open("about:blank", "_blank")
            let usedFallback = false

            const buildBlobHtml = (url) => {
                const doc = document.implementation.createHTMLDocument("IXL | Maths, English and Science Practice")
                doc.documentElement.lang = "en"
                const link = doc.createElement("link")
                link.rel = "icon"
                link.href = "https://ssl.gstatic.com/classroom/favicon.png"
                doc.head.appendChild(link)
                doc.body.style.margin = "0"
                doc.body.style.overflow = "hidden"
                const iframe = doc.createElement("iframe")
                iframe.src = url
                iframe.style.width = "100vw"
                iframe.style.height = "100vh"
                iframe.style.border = "0"
                doc.body.appendChild(iframe)
                return "<!doctype html>\n" + doc.documentElement.outerHTML
            }

            if (!cloakWin) {
                const blobHtml = buildBlobHtml(iframeUrl)
                const blob = new Blob([blobHtml], { type: "text/html" })
                const blobUrl = URL.createObjectURL(blob)
                cloakWin = window.open(blobUrl, "_blank")
                setTimeout(() => URL.revokeObjectURL(blobUrl), BLOB_URL_CLEANUP_DELAY_MS)
                usedFallback = true
            }

            if (!cloakWin) {
                return
            }

            try {
                cloakWin.document.title = "IXL | Maths, English and Science Practice"
                const link = cloakWin.document.createElement("link")
                link.rel = "icon"
                link.href = "https://ssl.gstatic.com/classroom/favicon.png"
                cloakWin.document.head.appendChild(link)
            } catch (e) {
                /* ignore cross-origin access to new window */
            }

            if (!usedFallback) {
                const iframe = cloakWin.document.createElement('iframe')
                iframe.style.width = '100vw'
                iframe.style.height = '100vh'
                iframe.style.border = 'none'
                cloakWin.document.body.style.margin = '0'
                iframe.src = targetUrl
                cloakWin.document.body.appendChild(iframe)
            }

            window.location.replace(CLOAK_REDIRECT)
        }

        const abToggle = document.getElementById("cloak-toggle")
        const abOn = localStorage.getItem("verdis_autoAB") ?? "no"

        function updateABSettings() {
            if (abToggle.checked) {
                console.log("checked")
                showToast("success", "Auto cloaking is now on!", "fas fa-check-circle")
                localStorage.setItem("verdis_autoAB", "yes")
            } else {
                console.log("unchecked")
                localStorage.setItem("verdis_autoAB", "no")
                showToast("success", "Auto cloaking is now off!", "fas fa-check-circle")
            }
        }

        if (abOn === "yes") {
            abToggle.checked = true
        } else {
            abToggle.checked = false
        }

        if (localStorage.getItem("verdis_autoAB") === "yes") {
            openAB()
        }

        const confirmLeaveOn = localStorage.getItem("verdis_confirmLeave") ?? "no"
        const confirmLeaveToggle = document.getElementById("confirm-leave-toggle")

        if (confirmLeaveOn === "yes") {
            confirmLeaveToggle.checked = true
        } else {
            confirmLeaveToggle.checked = false
        }

        function updateCLSettings() {
            if (confirmLeaveToggle.checked) {
                console.log("checked")
                showToast("success", "Confirm leave is now on!", "fas fa-check-circle")
                localStorage.setItem("verdis_confirmLeave", "yes")
            } else {
                console.log("unchecked")
                localStorage.setItem("verdis_confirmLeave", "no")
                showToast("success", "Confirm leave is now off!", "fas fa-check-circle")
            }
        }

        window.addEventListener("beforeunload", function (e) {
            if (localStorage.getItem("verdis_confirmLeave") === "yes") {
                e.preventDefault()
                e.returnValue = ""
            }
        })

        window.addEventListener("DOMContentLoaded", () => {
            const urlSearch =
                typeof getClassroomSearch === "function" ? getClassroomSearch() : window.location.search
            const params = new URLSearchParams(urlSearch)
            if (!params.get("launch")) {
                ensureRootPath()
            }
            if (params.get("page") && params.get("launch")) {
                navTo(params.get("page"))
            }
        })
    </script>
    <script>
        const styles = getComputedStyle(document.documentElement)

        function cssVar(name) {
            return styles.getPropertyValue(name).trim()
        }

        function hexToNumber(hex) {
            return parseInt(hex.replace("#", ""), 16)
        }

        const useFog = localStorage.getItem("verdis_particlesOn") ?? "yes"
        if (useFog === "yes") {
            if (window.vantaEffect) window.vantaEffect.destroy()
            window.vantaEffect = VANTA.FOG({
                el: "#vanta-fog-container",
                mouseControls: true,
                touchControls: true,
                gyroControls: false,
                minHeight: 200.00,
                minWidth: 200.00,
                highlightColor: hexToNumber(cssVar("--accent")),
                midtoneColor: hexToNumber(cssVar("--bg-2")),
                lowlightColor: hexToNumber(cssVar("--bg-5")),
                baseColor: hexToNumber(cssVar("--bg")),
                blurFactor: 0.90,
                speed: 1
            })
        }


    </script>
    <script>
        // --- Game Mode Optimization & Proxy Loader ---
        const gmStyle = document.createElement('style');
        gmStyle.textContent = `
            .game-mode #homeContent, 
            .game-mode #quickAccessSection,
            .game-mode .carousel-container { 
                display: none !important; 
            }
        `;
        document.head.appendChild(gmStyle);

        window.enterGameMode = function () {
            if (document.body.classList.contains('game-mode')) return;
            console.log("Verdis: Entering Game Mode (Optimized)");
            document.body.classList.add('game-mode');

            // Disable Vanta
            if (window.vantaEffect) {
                window.vantaEffect.destroy();
                // We keep usingPJS state but destroy the visual
            }

            // Disable Particles if any
            if (window.pJSDom && window.pJSDom.length > 0) {
                try {
                    window.pJSDom[0].pJS.fn.vendors.destroypJS();
                    window.pJSDom = [];
                } catch (e) { console.warn("Error destroying particles", e); }
            }

            const fogContainer = document.getElementById("vanta-fog-container");
            if (fogContainer) fogContainer.style.display = 'none';
        }

        window.exitGameMode = function () {
            if (!document.body.classList.contains('game-mode')) return;
            console.log("Verdis: Exiting Game Mode");
            document.body.classList.remove('game-mode');

            // Restore Vanta if it was enabled
            const pjsIsOn = localStorage.getItem("verdis_particlesOn") ?? "yes";
            if (pjsIsOn === "yes") {
                let pcont = document.getElementById("vanta-fog-container");
                if (!pcont) {
                    const newpjs = document.createElement("div");
                    newpjs.setAttribute("id", "vanta-fog-container");
                    document.body.append(newpjs);
                } else {
                    pcont.style.display = 'block';
                }
                // Re-init logic is in updatePJS, but we need to ensure checkbox is correct first or just call VANTA directly
                // updatePJS relies on checkbox. Let's rely on updatePJS to handle it based on checkbox state (which should match storage on load)
                updatePJS();
            }
        }

        // Umami Proxy Loader

    </script>
    <script src="/assets/js/walkthrough.js" defer></script>
</body>